<!doctype html>
<html>
<head>
  <meta charset=utf-8>
  <title>Chat</title>

  <style media="screen">
    #chat-room{
      border: 2px solid black;
      width:300px;
      height:200px;
    }
  </style>
  <script type="text/javascript" src='{{ static_url("jquery.js")}}'></script>
  <script type="text/javascript">
    var webSocket;
    var code=[0,1,2]; //0 incase of name and 1 incase of message
    var myName="Anonymous";

    $(function(){
      webSocket=new WebSocket("ws://localhost:7500/ws");
      webSocket.onmessage=function(e){
        // console.log(e.data);
        var receivedMessage=JSON.parse(e.data);
        // console.log(receivedMessage);
        if (receivedMessage["code"]!=2) {
          $("#chat-room").append("<p>"+receivedMessage+"</p>");
        }
        else {
          // console.log(receivedMessage[1])
          $("#online-clients").html("")
          var onlineUsers=receivedMessage["list"]
          $("#online-clients").append("<option value='all'>all</option>")

          for (var i = 0; i < onlineUsers.length; i++) {
            if(onlineUsers[i]!=myName)
              $("#online-clients").append("<option value='"+onlineUsers[i]+"'>"+onlineUsers[i]+"</option>")
          }
        }

      }
      $("#change-name").on('click',function(event) {
        myName=$("#chooseYourName").val();
        webSocket.send(code[0]+"/"+$("#chooseYourName").val());
        $("#chooseYourName").val('');
      });
      $("#send-button").on('click',function(event) {
        if ($("#online-clients").val()=="all") {
          webSocket.send(code[1]+"/"+$("#message").val());
          $("#message").val("");
        }
        else{
          webSocket.send(code[2]+"/"+$("#message").val()+"/"+$("#online-clients").val());
          $("#chat-room").append("<p>"+"PrivateMessageTo: "+$("#online-clients").val()+myName+": "+$("#message").val()+"</p>");
          $("#message").val("");
        }

      });
    })
  </script>
</head>
<body>
  <label for="chooseYourName">Choose your Name:</label>
  <input type="text" id="chooseYourName">
  <input type="button" id="change-name" value="change">
  <br>
  <br>
  <br>
  <br>

  <div id="chat-room"></div>
  <br>
  <input type="text" id="message">
  <select id="online-clients">

  </select>
  <input type="button" id="send-button" value="send">

</body>
</html>
